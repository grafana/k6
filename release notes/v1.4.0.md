k6 `<version>` is here ðŸŽ‰! This release includes:

- Browser module gets:
  - `page.waitForRequest` for waiting on specific HTTP requests.
  - `QueryAll` methods now return elements in DOM order.
  - `locator.evaluate` and `locator.evaluateHandle` for executing JavaScript code in the page context with access to the matching element.
  - `page.unroute(url)` and `page.unrouteAll` for removing routes registered with `page.route`.
  - OpenTelemetry output graduated from experimental to stable status.

## Breaking changes

As per our [stability guarantees](https://grafana.com/docs/k6/latest/reference/versioning-and-stability-guarantees/), breaking changes across minor releases are allowed only for experimental features.

### Breaking changes for experimental modules

- [#5164](https://github.com/grafana/k6/pull/5164) OpenTelemetry output now exports rate metrics as a single counter with `zero`/`nonzero` labels instead of separate metrics.
- [#5333](https://github.com/grafana/k6/pull/5333) OpenTelemetry output configuration: `K6_OTEL_EXPORTER_TYPE` is deprecated in favor of `K6_OTEL_EXPORTER_PROTOCOL` to align with OpenTelemetry standards.
- `#pr`, `<small_break_2>`

### (_optional h3_) `<big_breaking_change>` `#pr`

## New features

_optional intro here_

### OpenTelemetry output graduation [#5334](https://github.com/grafana/k6/pull/5334)

The OpenTelemetry output has graduated from experimental status and is now available as a stable output using the name `opentelemetry`. This change makes OpenTelemetry the recommended vendor-agnostic solution for exporting k6 telemetry data.

You can now use the stable output name in your k6 commands:

```bash
# Previous experimental usage (still supported for backward compatibility)
k6 run --out experimental-opentelemetry script.js

# New stable usage
k6 run --out opentelemetry script.js
```

The `experimental-opentelemetry` name will continue to work for backward compatibility for now but it's deprecated and we might remove it in future versions. We recommend migrating to use the new `opentelemetry` name.

### `page.waitForRequest` [#5330](https://github.com/grafana/k6/pull/5330)

The browser module now supports [`page.waitForRequest()`](https://grafana.com/docs/k6/<K6_VERSION>/javascript-api/k6-browser/page/waitforrequest/), which allows you to wait for HTTP requests that match specific URL patterns during browser automation. This method is particularly valuable for testing scenarios where you need to ensure specific network requests are initiated before proceeding with test actions.

The method supports multiple URL pattern matching strategies:

```javascript
// Wait for exact URL match
const requestPromise = page.waitForRequest('https://api.example.com/data');
await page.click('button[data-testid="load-data"]');
const request = await requestPromise;

// Wait for regex pattern match
await page.waitForRequest(/\/api\/.*\.json$/);

// Use with Promise.all for coordinated actions
await Promise.all([
  page.waitForRequest('https://api.example.com/user-data'),
  page.click('button[data-testid="load-user-data"]')
]);
```

This complements the existing `waitForResponse` method by focusing on HTTP requests rather than responses, providing more granular control over network-dependent test scenarios.

### `page.unroute(url)` and `page.unrouteAll()` [#5223](https://github.com/grafana/k6/pull/5223)

The browser module now supports [`page.unroute(url)`](https://grafana.com/docs/k6/latest/javascript-api/k6-browser/page/unroute/) and [`page.unrouteAll()`](https://grafana.com/docs/k6/latest/javascript-api/k6-browser/page/unrouteall/), allowing you to remove routes previously registered with `page.route`.

Example usage:
```javascript
await page.route(/.*\/api\/pizza/, function (route) {
  console.log('Modifying request to /api/pizza');
  route.continue({
    postData: JSON.stringify({
      customName: 'My Pizza',
    }),
  });
});
...

await page.unroute(/.*\/api\/pizza/); // The URL needs to be exactly the same as the one used in the call to the `route` function
```

```javascript
await page.route(/.*\/api\/pizza/, function (route) {
  console.log('Modifying request to /api/pizza');
  route.continue({
    postData: JSON.stringify({
      customName: 'My Pizza',
    }),
  });
});
...

await page.unrouteAll();
```

### `locator.evaluate` and `locator.evaluateHandle` [#5306](https://github.com/grafana/k6/pull/5306)

The browser module now supports [`locator.evaluate`](https://grafana.com/docs/k6/latest/javascript-api/k6-browser/locator/evaluate/) and [`locator.evaluateHandle`](https://grafana.com/docs/k6/latest/javascript-api/k6-browser/locator/evaluatehandle/), allowing you to execute JavaScript code in the page context with access to the matching element. The only difference between `evaluate` and `evaluateHandle` is that `evaluateHandle` returns a [JSHandle](https://grafana.com/docs/k6/latest/javascript-api/k6-browser/jshandle/).

Example usage:
```javascript
await check(page, {
  'calling evaluate': async p => {
    const n = await p.locator('#pizza-name').evaluate(pizzaName => pizzaName.textContent);
    return n == 'Our recommendation:';
  }
});

await check(page, {
  'calling evaluate with arguments': async p => {
    const n = await p.locator('#pizza-name').evaluate((pizzaName, extra) => pizzaName.textContent + extra, ' Super pizza!');
    return n == 'Our recommendation: Super pizza!';
  }
});
```

```javascript
const jsHandle = await page.locator('#pizza-name').evaluateHandle((pizzaName) => pizzaName);

const obj = await jsHandle.evaluateHandle((handle) => {
  return { innerText: handle.innerText };
});
console.log(await obj.jsonValue()); // {"innerText":"Our recommendation:"}
```

## UX improvements and enhancements

_Format as `<number> <present_verb> <object>. <credit>`_:

- `#pr` `<description>`
- _`#999` Gives terminal output prettier printing. Thanks to `@person` for the help!_
- [#5307](https://github.com/grafana/k6/pull/5307) QueryAll methods now return elements in DOM order. Thank you, @shota3506 for the contribution.

## Bug fixes

_Format as `<number> <present_verb> <object>. <credit>`_:

- _`#111` Fixes race condition in runtime_
- [#5242](https://github.com/grafana/k6/pull/5242) Fixes cleanup errors on Windows for browser tests. 
- [#5322](https://github.com/grafana/k6/pull/5322) Fixes `browser.newPageInContext` bug where pages created in a non-existing browser context.

## Maintenance and internal improvements

- [#5238](https://github.com/grafana/k6/pull/5238) Browser: Fix early context cancellation in tests
- [#5347](https://github.com/grafana/k6/pull/5347), [#5349](https://github.com/grafana/k6/pull/5349) Browser: Move `k6ext.Promise` to the mapping layer.
- [#5340](https://github.com/grafana/k6/pull/5340) Browser: Simplify page event iteration by using an iterator.
- [#5315](https://github.com/grafana/k6/pull/5315), [#5311](https://github.com/grafana/k6/pull/5311) Browser: Revamped page event listening internals for addition of new features and better maintainability.
- [#5339](https://github.com/grafana/k6/pull/5339) Browser: Remove unused `VU` fields.
- [#5314](https://github.com/grafana/k6/pull/5314) Browser: Refactor pattern matcher.
- [#5222](https://github.com/grafana/k6/pull/5222) Browser: Fix linter errors and warnings.
- [#5207](https://github.com/grafana/k6/pull/5207) Browser: Refactor and improve selector parsing. Thank you, @elmiringos for the contribution.
- [#5308](https://github.com/grafana/k6/pull/5308) Format Go Doc comments. Thank you, @shota3506 for the contribution.
- [#5214](https://github.com/grafana/k6/pull/5214) Update release issue template after 1.3.0

## _Optional_ Roadmap

_Discussion of future plans_
